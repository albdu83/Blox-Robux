<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blox Robux - Retirer</title>
  <link rel="stylesheet" href="styleretirer.css" />
</head>

<body>
  <header>
  <div class="header-left">
    <a href="../index.html">
      <img src="../img/logo.png" alt="Logo Blox Robux" />
    </a>

    <div class="solde-box">
      <span>ðŸ’° Solde :</span>
      <span id="balance">0,00 R$</span>
    </div>

    <div class="text">BloxRobux</div>
  </div>

  <ul>
    <li><a href="../index.html">Acceuil</a></li>
      <li><a href="../Page de gain/gagner.html">Gagner des Robux</a></li>
      <li><a href="retirer.html" class="active">Retirer</a></li>
  </ul>
  </header>
  <main>
    <section class="retrait-container">
      <h1>ðŸ’¸ Retirer des Robux</h1>
      <p class="desc">
        Entrez le montant de Robux Ã  retirer depuis votre solde ci-dessus.
      </p>

      <div class="actions">
        <input id="amount" type="number" placeholder="Montant Ã  retirer (ex : 50)" />
        <input id="label" type="text" placeholder="Pseudo Roblox (facultatif)" />
        <button id="withdrawBtn">Retirer</button>
      </div>

      <div id="error" class="error" style="display:none;"></div>

      <h2>Historique des retraits</h2>
      <div id="transactions" class="transactions"></div>
    </section>
  </main>
  <div id="transition" class="fade-transition active"></div>
  <script>
    const el = (id) => document.getElementById(id);
    const formatMoney = (num) => {
      const n = (Math.round((num + Number.EPSILON) * 100) / 100).toFixed(2);
      return n.replace('.', ',') + ' R$';
    };

    const STORAGE_KEY = "bloxrobux_balance";
    function saveState(state) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
    function loadState() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (!data) return { balance: 0, transactions: [] };
      try { return JSON.parse(data); } catch { return { balance: 0, transactions: [] }; }
    }

    const balanceEl = el("balance");
    const amountEl = el("amount");
    const labelEl = el("label");
    const withdrawBtn = el("withdrawBtn");
    const transactionsEl = el("transactions");
    const errorEl = el("error");

    let state = loadState();

    function render() {
      balanceEl.textContent = formatMoney(state.balance);
      renderTransactions();
    }

    function renderTransactions() {
      transactionsEl.innerHTML = "";
      if (state.transactions.length === 0) {
        transactionsEl.innerHTML = '<p class="empty">Aucun retrait effectuÃ©.</p>';
        return;
      }
      state.transactions.slice().reverse().forEach(tx => {
        const div = document.createElement("div");
        div.className = "transaction";
        div.innerHTML = `
          <span>${tx.label || 'Retrait'}</span>
          <span class="neg">${formatMoney(tx.amount)}</span>
        `;
        transactionsEl.appendChild(div);
      });
    }

    function showError(msg) {
      errorEl.textContent = msg;
      errorEl.style.display = "block";
      setTimeout(() => errorEl.style.display = "none", 3000);
    }

    function addTransaction(value, label) {
      const amount = Math.round(value * 100) / 100;

      if (amount > state.balance) {
        showError("Solde insuffisant !");
        return;
      }

      const tx = {
        id: Date.now(),
        type: "withdraw",
        amount: -amount,
        label,
        date: new Date().toISOString()
      };

      state.balance -= amount;
      state.transactions.push(tx);
      saveState(state);
      render();
    }

    withdrawBtn.addEventListener("click", () => {
      const value = parseFloat(amountEl.value);
      if (isNaN(value) || value <= 0) return showError("Montant invalide !");
      addTransaction(value, labelEl.value.trim());
      amountEl.value = "";
      labelEl.value = "";
    });

    render();
  </script>
  <script src="../Server.js" defer></script>
  <script src="../Animation.js" defer></script>
</body>
</html>





