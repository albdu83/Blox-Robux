<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blox Robux - Gagner</title>
  <link rel="stylesheet" href="stylegagner.css">
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="header-left">
      <a href="../index.html">
        <img src="../img/logo.png" alt="Logo Blox Robux" />
      </a>
      <div class="solde-box">
        <span>ðŸ’° Solde :</span>
        <span id="balance">0,00 R$</span>
      </div>
      <div class="text">BloxRobux</div>
    </div>
    <ul>
      <li><a href="../index.html">Accueil</a></li>
      <li><a href="gagner.html">Gagner des Robux</a></li>
      <li><a href="../Page de retraits/retirer.html">Retirer</a></li>
    </ul>
  </header>

  <!-- INFORMATIONS -->
  <div class="informations" id="info">
    <p>ðŸ’³ ComplÃ©tez des offres sur nos <strong>sites partenaires</strong> pour Ãªtre rÃ©compensÃ©s ! Obtenez de l'aide sur <a href="https://discord.gg/QQMRtfBXpq">notre serveur Discord</a>.</p>
  </div>

  <!-- BITLABS -->
  <ul id="pk">
    <li><img src="../img/Bitlabs Logo.jfif" id="reload-bitlabs" alt="Reload Bitlabs"></li>
    <li><img src="../img/Timewall.png" id="btnGagner" alt="Gagner des Robux"></li>
  </ul>

  <div class="informations" id="info">
    <div class="bitLabs" id="bitlabs">
      <iframe src="https://web.bitlabs.ai/?uid=12345&token=5fe6d711-ec6d-4a09-b6a6-343b8f0d3c9b" id="offerwall1"></iframe>
    </div>
  </div>
  <div class="informations" id="info">
    <div id="timewall-container" style="display:none;"></div>
  </div>
  <!-- TRANSITION -->
  <div id="transition" class="fade-transition active">
    <div class="text" id="text-chargement">Chargement...</div>
  </div>

  <!-- SCRIPT TIMEWALL ET FIREBASE -->
  <script src="https://www.timewall.com/widget.js?site_id=2578908b35321055"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- Scripts dÃ©fÃ©rÃ©s -->
  <script src="../Data.js" defer></script>
  <script src="../Server.js" defer></script>
  <script src="../Animation.js" defer></script>
  <script src="../Amount.js" defer></script>

  <!-- SCRIPT PRINCIPAL -->
<script defer>
document.addEventListener("DOMContentLoaded", () => {

  const db = window.db;
  const balanceEl = document.getElementById("balance");
  const btnGagner = document.getElementById("btnGagner");
  const reloadBtn = document.getElementById("reload-bitlabs");

  // ID utilisateur
  function getUserID() {
    let id = localStorage.getItem("userID");
    if (!id) {
      id = "user_" + Math.random().toString(36).substr(2, 9);
      localStorage.setItem("userID", id);
      db.ref("users/" + id).set({ balance: 0, createdAt: Date.now() });
    }
    return id;
  }
  const userID = getUserID();


  // --- Display TimeWall ---
  btnGagner.addEventListener("click", () => {
    const container = document.getElementById("timewall-container");
    const bitlabs = document.getElementById("offerwall1");

    bitlabs.style.display = "none";
    container.style.display = "block";

    container.innerHTML = `
      <iframe 
        src="https://www.timewall.io/wall?site_id=2578908b35321055&user_id=${userID}"
        style="width:100%; height:600px; border:none;"
      ></iframe>
    `;
  });


  // Reload BitLabs
  reloadBtn.addEventListener("click", () => {
    const iframe = document.getElementById("offerwall1");
    const container = document.getElementById("timewall-container");

    container.style.display = "none";
    iframe.style.display = "block";
    iframe.src = iframe.src;
  });

    
  // Mise Ã  jour solde Firebase
  db.ref("users/" + userID + "/balance").on("value", snap => {
    const value = snap.val() || 0;
    balanceEl.textContent = Number(value).toFixed(2) + " R$";
  });

});
</script>
</body>
</html>
