<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blox R$ - Gagner</title>
  <link rel="stylesheet" href="stylegagner.css">
  <link rel="icon" type="image/png" href="../favicon.ico">
</head>
<body>
  <header>
  <!-- LEFT : logo + solde -->
  <div class="header-left">
    <a href="../index.html">
      <img src="../img/logo.png" alt="Logo Blox Robux" />
    </a>
    <div class="solde-box" id="solde-box">
      <span>ðŸ’° Solde :</span>
      <span id="balance">0,00 R$</span>
    </div>
  </div>

  <!-- TITRE CENTRÃ‰ DANS LE FLEX -->
  <div class="header-title">Blox R$</div>

  <!-- NAVIGATION -->
  <nav>
    <ul id="btns">
      <li><a href="../index.html">Accueil</a></li>
      <li><a href="gagner.html">Gagner des R$</a></li>
      <li><a href="#">Retirer</a></li>
    </ul>
  </nav>
  <div class="logo2">
    <img src="../img/Barres.png" alt="Barres" id="barres">
  </div>
</header>
<div class="navigation" id="navigation">
  <div class="nav-panel" id="nav-panel">
    <div class="logo2" id="logo2">
        <img src="../img/Back.png" alt="Barres" id="barres2">
    </div>
    <ul class="nave">
      <li>
        <div class="solde-box">
          <span>ðŸ’° Solde :</span>
          <span id="balance2">0,00 R$</span>
        </div>
      </li>
      <li><a id="btn-accueil" href="../index.html">Accueil</a></li>
      <li><a id="btn-win" href="gagner.html">Gagner des R$</a></li>
      <li><a id="btn-retrait" href="#">Retirer</a></li>
    </ul>
  </div>
</div>
  <!-- INFORMATIONS -->
  <div class="informations" id="info">
    <p>ðŸ’³ ComplÃ©tez des offres sur nos <strong>sites partenaires</strong> pour Ãªtre rÃ©compensÃ©s ! Obtenez de l'aide sur <a href="https://discord.gg/QQMRtfBXpq">notre serveur Discord</a>.</p>
  </div>

  <!-- BITLABS -->
  <ul id="pk">
    <li><img src="../img/Bitlabs Logo.jfif" id="reload-bitlabs" alt="Reload Bitlabs"></li>
    <li><img src="../img/Timewall.png" id="btnGagner" alt="Gagner des Robux"></li>
    <li><img src="../img/theoremereach_logo.png" alt="theoremereach" id="theoreme" class="theoreme"></li>
  </ul>

  <div class="informations" id="info">
    <div class="bitLabs" id="bitlabs">
      <iframe src="https://web.bitlabs.ai/?uid=12345&token=5fe6d711-ec6d-4a09-b6a6-343b8f0d3c9b" id="offerwall1"></iframe>
    </div>
  </div>

  <div class="TimeWall" id="TimeWall">
    <div id="timewall-container"></div>
  </div>

<div class="theoremereach" id="theoremereach">
  <div id="theoremecontainer"></div>
</div>

  <!-- TRANSITION -->
  <div id="transition" class="fade-transition active">
    <img src="../img/Robux.png" id="image" alt="Logo Blox Robux" />
    <div class="text" id="text-chargement">Chargement...</div>
  </div>
    <div class="separator"></div>
  <div class="separator" style="visibility: hidden;"></div>
  <!-- SCRIPT reach ET FIREBASE -->
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://s3.us-east-1.amazonaws.com/cdn.theoremreach/v3/theorem_reach.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- Scripts dÃ©fÃ©rÃ©s -->
  <script src="../Data.js" defer></script>
  <script src="../Server.js" defer></script>
  <script src="../Animation.js" defer></script>
  <script src="../Amount.js" defer></script>
  <!-- SCRIPT PRINCIPAL -->
<script defer>
document.addEventListener("DOMContentLoaded", () => {
    const db = window.db;
    if (!db) return console.error("Firebase Database non initialisÃ©e !");

    const balanceEl = document.getElementById("balance");
    const balanceEl2 = document.getElementById("balance2");
    const btnGagner = document.getElementById("btnGagner");
    const reloadBtn = document.getElementById("reload-bitlabs");
    const reachbtn = document.getElementById("theoreme")

    const API_BASE = "https://blox-robux.onrender.com";

    // --- RÃ©cupÃ©ration ou crÃ©ation ID utilisateur ---
    function getUserID() {
        let userID = localStorage.getItem("userID");
        if (!userID) {
            userID = "user_" + Math.random().toString(36).substr(2, 9);
            localStorage.setItem("userID", userID);
            db.ref("users/" + userID).set({ createdAt: Date.now(), balance: 0 })
              .catch(err => console.error("Erreur crÃ©ation utilisateur :", err));
        }
        return userID;
    }
    const userID = getUserID();

    // --- Mise Ã  jour du solde ---
    function displayBalance() {
        // RÃ©cupÃ¨re le solde depuis Firebase
        db.ref("users/" + userID + "/balance").once("value")
          .then(snapshot => {
           const balance = snapshot.val() || 0; // si pas de valeur, 0
            // Format FR avec 2 dÃ©cimales et ajout " R$"
            const formatted = balance.toLocaleString("fr-FR", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " R$";
            // Met Ã  jour tes Ã©lÃ©ments
            balanceEl.textContent = formatted;
            balanceEl2.textContent = formatted;
          })
          .catch(err => console.error("Erreur rÃ©cupÃ©ration balance :", err));
    }


    // --- Attendre que TimeWall soit chargÃ© ---
    function waitForTimeWall(callback) {
        if (typeof TimeWall !== "undefined") {
            callback();
        } else {
            setTimeout(() => waitForTimeWall(callback), 100);
        }
    }

    // --- Gestion bouton Gagner ---
    if (btnGagner) {
        btnGagner.addEventListener("click", () => {
            // Masquer BitLabs
            const theoreme = document.getElementById("theoremecontainer");
            const offerwall = document.getElementById("offerwall1");
            if (offerwall, theoreme) {
              offerwall.style.display = "none";
              theoreme.style.display = "none";
            }

            // Afficher container TimeWall
            const container = document.getElementById("timewall-container");
            if (container) {
              container.style.display = "flex";
              container.src = container.src;
            }
        });
    }

    if (reachbtn) {
        reachbtn.addEventListener("click", () => {
            // Masquer BitLabs
            const container = document.getElementById("timewall-container");
            const offerwall = document.getElementById("offerwall1");
            if (offerwall, container) {
              offerwall.style.display = "none";
              container.style.display = "none";
            }

            // Afficher container TimeWall
            const theoreme = document.getElementById("theoremecontainer");
            if (theoreme) {
              theoreme.style.display = "flex";
            }
        });
    }

    // --- Reload BitLabs iframe ---
    if (reloadBtn) {
        reloadBtn.addEventListener("click", () => {
            const theoreme = document.getElementById("theoremecontainer");
            const offerwall = document.getElementById("offerwall1");
            if (offerwall, theoreme) {
              offerwall.src = offerwall.src
              offerwall.style.display = "flex";
              theoreme.style.display = "none";
            }

            const container = document.getElementById("timewall-container");
            if (container) container.style.display = "none";
        });
    }

    // --- Sync solde Firebase en direct ---
db.ref("users/" + userID + "/balance").on("value", snapshot => {
    const value = parseFloat(snapshot.val() || 0);
    const formatted = value.toLocaleString("fr-FR", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " R$";
    balanceEl.textContent = formatted;
    balanceEl2.textContent = formatted;
});

    // --- RÃ©cupÃ©ration avatar Roblox via Render ---
    async function setRobloxAvatar(robloxName) {
        try {
            const res = await fetch(`${API_BASE}/api/avatar/${robloxName}`);
            if (!res.ok) throw new Error("Avatar non trouvÃ©");
            const data = await res.json();
            const avatarImg = document.getElementById("avatar-roblox");
            if (!avatarImg) return;
            avatarImg.src = data.avatarUrl || "../img/default-avatar.png";
            avatarImg.style.display = "inline-block";
        } catch (err) {
            console.error("Erreur avatar Roblox :", err);
        }
    }

const barres = document.getElementById("barres")
const btns = document.getElementById("btns")
const soldebox = document.getElementById("solde-box")
if (window.innerWidth >= 1024) {
  barres.style.display = "none"
} else {
  soldebox.style.display = "none"
  btns.style.display = "none"
}
});
</script>

<div id="Block">
 <img src="../img/Bloxlogo.png" alt="BloxRobuxLogo">
<div id="BlockBottom">
<div class="infos">
  <div class="col">
    <h2>A propos de nous</h2>
    <ul>
      <li><a href="">Biographie du site</a></li>
      <li><a href="">Paiements sÃ©curisÃ©s</a></li>
      <li><a href="">Support actif</a></li>
    </ul>
  </div>

  <div class="col">
    <h2>Mentions lÃ©gales</h2>
    <ul>
      <li><a href="../Legal/C.G.U.html">Conditions d'utilisations</a></li>
      <li><a href="../P.C.F.html">Politique de confidentialitÃ©</a></li>
    </ul>
  </div>

    <div class="col">
    <h2>RÃ©seaux sociaux</h2>
    <ul>
      <li><a href="https://discord.gg/QQMRtfBXpq">Discord</a></li>
      <li><a href="">YouTube (Ã  venir)</a></li>
    </ul>
  </div>
</div>
  </div>
<img src="../img/Bloxlogo.png" alt="BloxRobuxLogo" style="visibility: hidden;">
</div>
</body>
</html>
